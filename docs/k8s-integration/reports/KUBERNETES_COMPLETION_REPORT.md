# Kubernetes é›†ç¾¤ç®¡ç†åŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ¬¡å¼€å‘å®Œæˆäº† AnsFlow é¡¹ç›®çš„ Kubernetes é›†ç¾¤ç®¡ç†åŠŸèƒ½ï¼Œå®ç°äº†ä»æ¨¡æ‹Ÿæ•°æ®åˆ°çœŸå® API é›†æˆçš„å®Œæ•´å‡çº§ã€‚

## ğŸš€ å·²å®ŒæˆåŠŸèƒ½

### 1. åç«¯å®ç° (Django)

#### ğŸ”§ æ ¸å¿ƒç»„ä»¶
- **KubernetesManager å®¢æˆ·ç«¯** (`kubernetes_integration/k8s_client.py`)
  - æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼šTokenã€Kubeconfigã€å®¢æˆ·ç«¯è¯ä¹¦
  - çœŸå® Kubernetes API é›†æˆï¼Œæ”¯æŒæ¨¡æ‹Ÿæ¨¡å¼å›é€€
  - å®Œæ•´çš„é›†ç¾¤ä¿¡æ¯è·å–å’Œè¿æ¥éªŒè¯

- **æ•°æ®æ¨¡å‹** (`kubernetes_integration/models.py`)
  - KubernetesCluster: é›†ç¾¤ç®¡ç†
  - KubernetesNamespace: å‘½åç©ºé—´ç®¡ç†
  - KubernetesDeployment: éƒ¨ç½²ç®¡ç†
  - KubernetesService: æœåŠ¡ç®¡ç†
  - KubernetesPod: Pod ç®¡ç†
  - KubernetesConfigMap å’Œ KubernetesSecret: é…ç½®ç®¡ç†

#### ğŸŒ API ç«¯ç‚¹
- **é›†ç¾¤ç®¡ç† ViewSet**
  - `GET /api/kubernetes/clusters/` - è·å–é›†ç¾¤åˆ—è¡¨
  - `POST /api/kubernetes/clusters/` - åˆ›å»ºæ–°é›†ç¾¤
  - `PUT/PATCH /api/kubernetes/clusters/{id}/` - æ›´æ–°é›†ç¾¤
  - `DELETE /api/kubernetes/clusters/{id}/` - åˆ é™¤é›†ç¾¤
  - `POST /api/kubernetes/clusters/validate-connection/` - éªŒè¯é›†ç¾¤è¿æ¥
  - `POST /api/kubernetes/clusters/{id}/check-connection/` - æ£€æŸ¥é›†ç¾¤çŠ¶æ€
  - `POST /api/kubernetes/clusters/{id}/sync-resources/` - åŒæ­¥é›†ç¾¤èµ„æº
  - `GET /api/kubernetes/clusters/{id}/overview/` - è·å–é›†ç¾¤æ¦‚è§ˆ

- **å‘½åç©ºé—´ç®¡ç† ViewSet**
  - å®Œæ•´çš„ CRUD æ“ä½œ
  - æŒ‰é›†ç¾¤è¿‡æ»¤
  - èµ„æºç»Ÿè®¡

#### âš¡ å¼‚æ­¥ä»»åŠ¡ (Celery)
- é›†ç¾¤çŠ¶æ€æ£€æŸ¥ä»»åŠ¡
- èµ„æºåŒæ­¥ä»»åŠ¡
- åº”ç”¨éƒ¨ç½²ä»»åŠ¡
- æ‰©ç¼©å®¹ä»»åŠ¡

#### ğŸ› ï¸ ç®¡ç†å‘½ä»¤
- `test_k8s_connection` - æµ‹è¯•é›†ç¾¤è¿æ¥
- `create_test_clusters` - åˆ›å»ºæµ‹è¯•æ•°æ®

### 2. å‰ç«¯å®ç° (React + TypeScript)

#### ğŸ¨ ç”¨æˆ·ç•Œé¢
- **é›†ç¾¤ç®¡ç†é¡µé¢** (`frontend/src/pages/Kubernetes.tsx`)
  - é›†ç¾¤åˆ—è¡¨å±•ç¤º
  - é›†ç¾¤åˆ›å»º/ç¼–è¾‘è¡¨å•
  - è¿æ¥çŠ¶æ€å®æ—¶éªŒè¯
  - ç»Ÿè®¡å¡ç‰‡å±•ç¤º

#### ğŸ“Š åŠŸèƒ½ç‰¹æ€§
- **å¤šè®¤è¯æ–¹å¼æ”¯æŒ**
  - Bearer Token è®¤è¯
  - Kubeconfig æ–‡ä»¶è®¤è¯
  - å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯

- **å®æ—¶è¿æ¥éªŒè¯**
  - åˆ›å»ºå‰éªŒè¯é›†ç¾¤è¿æ¥
  - å®æ—¶çŠ¶æ€æ£€æŸ¥
  - é”™è¯¯ä¿¡æ¯å±•ç¤º

- **ç”¨æˆ·å‹å¥½ç•Œé¢**
  - Ant Design ç»„ä»¶åº“
  - å“åº”å¼è®¾è®¡
  - æ“ä½œç¡®è®¤å¼¹çª—

#### ğŸ”— API æœåŠ¡å±‚
- **å®Œæ•´çš„ API æ–¹æ³•** (`frontend/src/services/api.ts`)
  - validateKubernetesConnection
  - checkKubernetesClusterConnection
  - getKubernetesClusters
  - createKubernetesCluster
  - updateKubernetesCluster
  - deleteKubernetesCluster

### 3. æ•°æ®éªŒè¯ä¸å®‰å…¨

#### ğŸ” åºåˆ—åŒ–å™¨
- `KubernetesClusterValidationSerializer` - è¿æ¥éªŒè¯
- `KubernetesClusterSerializer` - é›†ç¾¤æ•°æ®
- `KubernetesNamespaceSerializer` - å‘½åç©ºé—´æ•°æ®

#### ğŸ›¡ï¸ æƒé™æ§åˆ¶
- ç”¨æˆ·è®¤è¯è¦æ±‚
- åˆ›å»ºè€…å…³è”
- æ•°æ®è®¿é—®æ§åˆ¶

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•ç¯å¢ƒ
- **åç«¯æœåŠ¡**: Django åœ¨ 8000 ç«¯å£è¿è¡Œ
- **å‰ç«¯æœåŠ¡**: Vite åœ¨ 5173 ç«¯å£è¿è¡Œ
- **æ•°æ®åº“**: MySQL è¿æ¥æ­£å¸¸
- **æ—¥å¿—ç³»ç»Ÿ**: ç»Ÿä¸€æ—¥å¿—é›†æˆæˆåŠŸ

### æµ‹è¯•æ•°æ®
å·²åˆ›å»º 3 ä¸ªæµ‹è¯•é›†ç¾¤ï¼š
1. å¼€å‘ç¯å¢ƒé›†ç¾¤ (Token è®¤è¯)
2. ç”Ÿäº§ç¯å¢ƒé›†ç¾¤ (Kubeconfig è®¤è¯ï¼Œé»˜è®¤é›†ç¾¤)
3. æµ‹è¯•ç¯å¢ƒé›†ç¾¤ (è¯ä¹¦è®¤è¯)

### éªŒè¯ç»“æœ
- âœ… è¿æ¥éªŒè¯åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ¨¡æ‹Ÿæ¨¡å¼æ­£ç¡®å›é€€
- âœ… API ç«¯ç‚¹å“åº”æ­£å¸¸
- âœ… å‰ç«¯ç•Œé¢æ¸²æŸ“æ­£ç¡®
- âœ… æ•°æ®åº“æ“ä½œæˆåŠŸ

## ğŸ” æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Django + Django REST Framework
- **æ•°æ®åº“**: MySQL
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery + Redis
- **K8s é›†æˆ**: kubernetes Python åº“
- **è®¤è¯**: Django è®¤è¯ç³»ç»Ÿ

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: React 18 + TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **UI åº“**: Ant Design
- **HTTP å®¢æˆ·ç«¯**: Axios
- **çŠ¶æ€ç®¡ç†**: React Hooks

### éƒ¨ç½²æ¶æ„
- **å¾®æœåŠ¡æ¶æ„**: Django (8000) + FastAPI (8001)
- **å‰ç«¯**: Vite Dev Server (5173)
- **æ•°æ®åº“**: MySQL
- **ç¼“å­˜**: Redis
- **å®¹å™¨åŒ–**: Docker æ”¯æŒ

## ğŸ“ˆ åŠŸèƒ½äº®ç‚¹

### 1. å¤šè®¤è¯æ–¹å¼æ”¯æŒ
- çµæ´»æ”¯æŒ 3 ç§ä¸»æµ K8s è®¤è¯æ–¹å¼
- å®‰å…¨çš„è®¤è¯ä¿¡æ¯å­˜å‚¨
- è¿æ¥å‰éªŒè¯æœºåˆ¶

### 2. å®æ—¶çŠ¶æ€ç›‘æ§
- å¼‚æ­¥çŠ¶æ€æ£€æŸ¥
- è‡ªåŠ¨çŠ¶æ€æ›´æ–°
- å¥åº·æ£€æŸ¥æœºåˆ¶

### 3. ç”¨æˆ·å‹å¥½ä½“éªŒ
- ç›´è§‚çš„ç®¡ç†ç•Œé¢
- å®æ—¶éªŒè¯åé¦ˆ
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### 4. å¯æ‰©å±•æ¶æ„
- æ¨¡å—åŒ–è®¾è®¡
- æ¸…æ™°çš„ä»£ç ç»“æ„
- å®Œæ•´çš„æ–‡æ¡£æ³¨é‡Š

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. å¯åŠ¨æœåŠ¡
```bash
# åç«¯ Django (8000ç«¯å£)
cd backend/django_service
uv run python manage.py runserver 8000

# å‰ç«¯ React (5173ç«¯å£)
cd frontend
npm run dev
```

### 2. åˆ›å»ºé›†ç¾¤
1. è®¿é—® http://localhost:5173/kubernetes
2. ç‚¹å‡»"æ·»åŠ é›†ç¾¤"æŒ‰é’®
3. å¡«å†™é›†ç¾¤ä¿¡æ¯å’Œè®¤è¯é…ç½®
4. ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯è¿æ¥
5. ä¿å­˜é›†ç¾¤é…ç½®

### 3. ç®¡ç†é›†ç¾¤
- æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨å’ŒçŠ¶æ€
- ç¼–è¾‘é›†ç¾¤é…ç½®
- æ£€æŸ¥è¿æ¥çŠ¶æ€
- åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤

## ğŸš§ åç»­ä¼˜åŒ–æ–¹å‘

### 1. åŠŸèƒ½å¢å¼º
- [ ] é›†ç¾¤èµ„æºç›‘æ§é¢æ¿
- [ ] Pod æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½
- [ ] YAML é…ç½®ç¼–è¾‘å™¨
- [ ] é›†ç¾¤æ€§èƒ½æŒ‡æ ‡å±•ç¤º

### 2. ç”¨æˆ·ä½“éªŒ
- [ ] é›†ç¾¤è¿æ¥çŠ¶æ€å®æ—¶æ¨é€
- [ ] æ‰¹é‡æ“ä½œåŠŸèƒ½
- [ ] å¯¼å…¥/å¯¼å‡ºé›†ç¾¤é…ç½®
- [ ] æ“ä½œå†å²è®°å½•

### 3. å®‰å…¨åŠ å›º
- [ ] è®¤è¯ä¿¡æ¯åŠ å¯†å­˜å‚¨
- [ ] ç»†ç²’åº¦æƒé™æ§åˆ¶
- [ ] æ“ä½œå®¡è®¡æ—¥å¿—
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ

## ğŸ“ æ€»ç»“

æœ¬æ¬¡å¼€å‘æˆåŠŸå®ç°äº† AnsFlow é¡¹ç›®çš„ Kubernetes é›†ç¾¤ç®¡ç†åŠŸèƒ½ï¼Œä»å‰ç«¯ç”¨æˆ·ç•Œé¢åˆ°åç«¯ API æœåŠ¡ï¼Œå†åˆ°æ•°æ®åº“å­˜å‚¨ï¼Œå½¢æˆäº†å®Œæ•´çš„åŠŸèƒ½é—­ç¯ã€‚ç³»ç»Ÿæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå…·å¤‡å®æ—¶éªŒè¯èƒ½åŠ›ï¼Œä¸ºç”¨æˆ·æä¾›äº†å‹å¥½çš„é›†ç¾¤ç®¡ç†ä½“éªŒã€‚

**å¼€å‘æ—¶é—´**: 2025å¹´8æœˆ12æ—¥  
**å¼€å‘çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡  
**éƒ¨ç½²çŠ¶æ€**: âœ… å°±ç»ª  

ç°åœ¨ç”¨æˆ·å¯ä»¥é€šè¿‡ http://localhost:5173/kubernetes é¡µé¢ç®¡ç† Kubernetes é›†ç¾¤äº†ï¼
