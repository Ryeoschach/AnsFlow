# 步骤编辑流程最终优化

## 优化目标
点击"更新步骤"后，关闭步骤编辑抽屉，回到流水线主编辑页面，而不是跳转到流水线列表页面。

## 修改内容

### 1. 页面跳转问题修复
- **移除自动保存时的 onSave 回调**：在步骤编辑自动保存时不调用 `onSave` 回调，避免父组件触发页面跳转
- **保留手动保存时的 onSave 回调**：只有在点击"保存流水线"按钮时才调用 `onSave` 回调

### 2. 抽屉关闭逻辑优化
- **统一关闭行为**：不管是添加新步骤还是编辑现有步骤，点击提交后都关闭步骤编辑抽屉
- **清理状态**：关闭抽屉时清理所有编辑相关的状态

## 最终用户体验流程

### ✅ 编辑现有步骤
1. 在流水线编辑页面，点击步骤的"编辑"按钮
2. 打开步骤编辑抽屉，修改步骤内容
3. 点击"更新步骤"按钮
4. **结果**：
   - 步骤内容保存到后端
   - 步骤编辑抽屉关闭
   - 回到流水线主编辑页面
   - 页面不跳转，保持在流水线编辑界面

### ✅ 添加新步骤
1. 在流水线编辑页面，点击"添加步骤"按钮
2. 打开步骤编辑抽屉，填写新步骤信息
3. 点击"添加步骤"按钮
4. **结果**：
   - 新步骤添加到流水线
   - 步骤编辑抽屉关闭
   - 回到流水线主编辑页面

### ✅ 继续编辑其他步骤
1. 在流水线主编辑页面，可以：
   - 点击其他步骤的"编辑"按钮继续编辑
   - 点击"添加步骤"按钮添加新步骤
   - 点击"保存流水线"按钮保存整个流水线（这时才会调用 onSave 回调）

## 关键代码修改

### 修改前
```typescript
// 复杂的条件判断，编辑时保持抽屉打开
if (!editingStep) {
  setStepFormVisible(false)
} else {
  // 保持抽屉打开，切换到添加模式
  setEditingStep(null)
  // ... 重置表单为添加模式
}
```

### 修改后
```typescript
// 简化逻辑，统一关闭抽屉
setStepFormVisible(false)

// 清理编辑状态
setEditingStep(null)
setSelectedStepType('')
setShowParameterDoc(false)
form.resetFields()
```

## 验证要点

### ✅ 主要验证项
1. **编辑步骤不跳转页面**：编辑任意步骤后，页面保持在流水线编辑界面
2. **抽屉正确关闭**：点击"更新步骤"后，步骤编辑抽屉关闭
3. **数据正确保存**：修改的内容能正确保存到后端
4. **界面状态正确**：回到流水线主编辑页面，能看到更新后的步骤内容

### ✅ 次要验证项
1. **添加步骤正常**：添加新步骤的功能不受影响
2. **其他功能正常**：删除、拖拽排序等功能正常
3. **手动保存正常**：点击"保存流水线"按钮的功能正常

## 测试步骤

### 快速测试
1. 打开任意流水线的编辑页面
2. 点击某个步骤的"编辑"按钮
3. 修改步骤内容（如名称、描述等）
4. 点击"更新步骤"按钮
5. 验证：
   - 抽屉关闭 ✅
   - 回到流水线编辑页面 ✅  
   - 页面没有跳转到列表页 ✅
   - 步骤内容已更新 ✅

### 完整测试
1. 编辑多个步骤，验证每次都能正确回到主编辑页面
2. 添加新步骤，验证功能正常
3. 点击"保存流水线"，验证整体保存功能正常

## 总结
现在的流程更加直观和高效：
- **编辑步骤** → **关闭抽屉** → **回到主编辑页面**
- **继续编辑其他步骤或添加新步骤**
- **最后统一保存流水线**

这样的设计既避免了页面跳转问题，又保持了良好的用户体验。
