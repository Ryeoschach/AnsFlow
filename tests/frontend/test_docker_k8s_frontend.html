<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker/K8s Ê≠•È™§Á±ªÂûãÊµãËØï</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/antd@5.12.8/dist/antd.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/antd@5.12.8/dist/reset.css" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .step-preview {
            margin-top: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #1890ff;
        }
        .step-config {
            margin-bottom: 24px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            overflow: hidden;
        }
        .step-config-header {
            background: #fafafa;
            padding: 16px;
            border-bottom: 1px solid #e8e8e8;
            font-weight: 600;
            color: #262626;
        }
        .step-config-body {
            padding: 16px;
        }
        .success { color: #52c41a; }
        .error { color: #ff4d4f; }
        .warning { color: #fa8c16; }
        .info { color: #1890ff; }
        
        .test-result {
            margin: 16px 0;
            padding: 12px;
            border-radius: 6px;
            background: #f6f8fa;
        }
        
        .test-result.success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
        }
        
        .test-result.error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
        }
        
        .code-block {
            background: #f1f3f4;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 16px;
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
            margin: 12px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            Card, 
            Form, 
            Input, 
            Select, 
            Button, 
            Space, 
            Typography, 
            Alert, 
            Divider, 
            Tag,
            Switch,
            InputNumber,
            Collapse,
            Row,
            Col
        } = antd;
        
        const { Title, Text, Paragraph } = Typography;
        const { Option } = Select;
        const { Panel } = Collapse;

        // Ê®°ÊãüÊï∞ÊçÆ
        const mockDockerRegistries = [
            {
                id: 1,
                name: 'Docker Hub',
                url: 'docker.io',
                is_default: true,
                is_active: true
            },
            {
                id: 2,
                name: 'Harbor Registry',
                url: 'harbor.company.com',
                is_default: false,
                is_active: true
            }
        ];

        const mockK8sClusters = [
            {
                id: 1,
                name: 'Production Cluster',
                api_server: 'https://k8s-prod.company.com:6443',
                status: 'connected',
                description: 'Áîü‰∫ßÁéØÂ¢ÉÈõÜÁæ§'
            },
            {
                id: 2,
                name: 'Development Cluster',
                api_server: 'https://k8s-dev.company.com:6443',
                status: 'connected',
                description: 'ÂºÄÂèëÁéØÂ¢ÉÈõÜÁæ§'
            }
        ];

        const mockK8sNamespaces = [
            {
                id: 1,
                name: 'default',
                cluster: 1,
                status: 'active'
            },
            {
                id: 2,
                name: 'production',
                cluster: 1,
                status: 'active'
            },
            {
                id: 3,
                name: 'development',
                cluster: 2,
                status: 'active'
            }
        ];

        const dockerStepTypes = [
            { value: 'docker_build', label: 'Docker Build', description: 'ÊûÑÂª∫ Docker ÈïúÂÉè' },
            { value: 'docker_run', label: 'Docker Run', description: 'ËøêË°å Docker ÂÆπÂô®' },
            { value: 'docker_push', label: 'Docker Push', description: 'Êé®ÈÄÅÈïúÂÉèÂà∞Ê≥®ÂÜåË°®' },
            { value: 'docker_pull', label: 'Docker Pull', description: '‰ªéÊ≥®ÂÜåË°®ÊãâÂèñÈïúÂÉè' }
        ];

        const k8sStepTypes = [
            { value: 'k8s_deploy', label: 'Kubernetes Deploy', description: 'ÈÉ®ÁΩ≤Âà∞ K8s ÈõÜÁæ§' },
            { value: 'k8s_scale', label: 'Kubernetes Scale', description: 'Êâ©Áº©ÂÆπ K8s ÈÉ®ÁΩ≤' },
            { value: 'k8s_delete', label: 'Kubernetes Delete', description: 'Âà†Èô§ K8s ËµÑÊ∫ê' },
            { value: 'k8s_wait', label: 'Kubernetes Wait', description: 'Á≠âÂæÖ K8s ËµÑÊ∫êÁä∂ÊÄÅ' },
            { value: 'k8s_exec', label: 'Kubernetes Exec', description: 'Âú® Pod ‰∏≠ÊâßË°åÂëΩ‰ª§' },
            { value: 'k8s_logs', label: 'Kubernetes Logs', description: 'Ëé∑Âèñ Pod Êó•Âøó' }
        ];

        // ÁÆÄÂåñÁöÑ Docker ÈÖçÁΩÆÁªÑ‰ª∂
        const DockerStepConfigTest = ({ stepType, form }) => {
            if (!stepType?.startsWith('docker_')) return null;

            return (
                <div className="step-config">
                    <div className="step-config-header">
                        üê≥ Docker {stepType.replace('docker_', '').toUpperCase()} ÈÖçÁΩÆ
                    </div>
                    <div className="step-config-body">
                        <Form.Item
                            name="docker_image"
                            label="ÈïúÂÉèÂêçÁß∞"
                            rules={[{ required: true, message: 'ËØ∑ËæìÂÖ•ÈïúÂÉèÂêçÁß∞' }]}
                        >
                            <Input placeholder="‰æãÂ¶Ç: myapp" />
                        </Form.Item>

                        <Form.Item
                            name="docker_tag"
                            label="ÈïúÂÉèÊ†áÁ≠æ"
                            initialValue="latest"
                        >
                            <Input placeholder="‰æãÂ¶Ç: latest, v1.0.0" />
                        </Form.Item>

                        {stepType === 'docker_build' && (
                            <>
                                <Form.Item
                                    name={['docker_config', 'dockerfile_path']}
                                    label="Dockerfile Ë∑ØÂæÑ"
                                >
                                    <Input placeholder="‰æãÂ¶Ç: ./Dockerfile" />
                                </Form.Item>
                                <Form.Item
                                    name={['docker_config', 'context_path']}
                                    label="ÊûÑÂª∫‰∏ä‰∏ãÊñá"
                                >
                                    <Input placeholder="‰æãÂ¶Ç: ." />
                                </Form.Item>
                            </>
                        )}

                        {stepType === 'docker_run' && (
                            <>
                                <Form.Item
                                    name={['docker_config', 'ports']}
                                    label="Á´ØÂè£Êò†Â∞Ñ"
                                >
                                    <Input placeholder="‰æãÂ¶Ç: 8080:80" />
                                </Form.Item>
                                <Form.Item
                                    name={['docker_config', 'detach']}
                                    valuePropName="checked"
                                >
                                    <Switch checkedChildren="ÂêéÂè∞ËøêË°å" unCheckedChildren="ÂâçÂè∞ËøêË°å" />
                                </Form.Item>
                            </>
                        )}

                        {(stepType === 'docker_push' || stepType === 'docker_pull') && (
                            <Form.Item
                                name="docker_registry"
                                label="Docker Ê≥®ÂÜåË°®"
                            >
                                <Select placeholder="ÈÄâÊã©Ê≥®ÂÜåË°®">
                                    {mockDockerRegistries.map(registry => (
                                        <Option key={registry.id} value={registry.id}>
                                            {registry.name} ({registry.url})
                                            {registry.is_default && <Tag color="blue" style={{ marginLeft: 8 }}>ÈªòËÆ§</Tag>}
                                        </Option>
                                    ))}
                                </Select>
                            </Form.Item>
                        )}
                    </div>
                </div>
            );
        };

        // ÁÆÄÂåñÁöÑ K8s ÈÖçÁΩÆÁªÑ‰ª∂
        const KubernetesStepConfigTest = ({ stepType, form }) => {
            if (!stepType?.startsWith('k8s_')) return null;

            return (
                <div className="step-config">
                    <div className="step-config-header">
                        ‚ò∏Ô∏è Kubernetes {stepType.replace('k8s_', '').toUpperCase()} ÈÖçÁΩÆ
                    </div>
                    <div className="step-config-body">
                        <Form.Item
                            name="k8s_cluster"
                            label="K8s ÈõÜÁæ§"
                            rules={[{ required: true, message: 'ËØ∑ÈÄâÊã©ÈõÜÁæ§' }]}
                        >
                            <Select placeholder="ÈÄâÊã©ÈõÜÁæ§">
                                {mockK8sClusters.map(cluster => (
                                    <Option key={cluster.id} value={cluster.id}>
                                        {cluster.name}
                                        <Tag color={cluster.status === 'connected' ? 'green' : 'red'} style={{ marginLeft: 8 }}>
                                            {cluster.status === 'connected' ? 'Â∑≤ËøûÊé•' : 'Êú™ËøûÊé•'}
                                        </Tag>
                                    </Option>
                                ))}
                            </Select>
                        </Form.Item>

                        <Form.Item
                            name="k8s_namespace"
                            label="ÂëΩÂêçÁ©∫Èó¥"
                            rules={[{ required: true, message: 'ËØ∑ËæìÂÖ•ÂëΩÂêçÁ©∫Èó¥' }]}
                        >
                            <Select placeholder="ÈÄâÊã©ÂëΩÂêçÁ©∫Èó¥">
                                {mockK8sNamespaces.map(ns => (
                                    <Option key={ns.id} value={ns.name}>
                                        {ns.name}
                                        <Tag color="green" style={{ marginLeft: 8 }}>Ê¥ªË∑É</Tag>
                                    </Option>
                                ))}
                            </Select>
                        </Form.Item>

                        <Form.Item
                            name="k8s_resource_name"
                            label="ËµÑÊ∫êÂêçÁß∞"
                            rules={[{ required: true, message: 'ËØ∑ËæìÂÖ•ËµÑÊ∫êÂêçÁß∞' }]}
                        >
                            <Input placeholder="‰æãÂ¶Ç: my-app-deployment" />
                        </Form.Item>

                        {stepType === 'k8s_deploy' && (
                            <Form.Item
                                name={['k8s_config', 'manifest_path']}
                                label="Manifest Êñá‰ª∂Ë∑ØÂæÑ"
                            >
                                <Input placeholder="‰æãÂ¶Ç: k8s/deployment.yaml" />
                            </Form.Item>
                        )}

                        {stepType === 'k8s_scale' && (
                            <Form.Item
                                name={['k8s_config', 'replicas']}
                                label="ÂâØÊú¨Êï∞Èáè"
                                rules={[{ required: true, message: 'ËØ∑ËæìÂÖ•ÂâØÊú¨Êï∞Èáè' }]}
                            >
                                <InputNumber min={0} max={100} placeholder="3" style={{ width: '100%' }} />
                            </Form.Item>
                        )}

                        {stepType === 'k8s_wait' && (
                            <Form.Item
                                name={['k8s_config', 'condition']}
                                label="Á≠âÂæÖÊù°‰ª∂"
                                rules={[{ required: true, message: 'ËØ∑ÈÄâÊã©Á≠âÂæÖÊù°‰ª∂' }]}
                            >
                                <Select placeholder="ÈÄâÊã©Êù°‰ª∂">
                                    <Option value="Available">Available</Option>
                                    <Option value="Ready">Ready</Option>
                                    <Option value="Complete">Complete</Option>
                                </Select>
                            </Form.Item>
                        )}

                        {(stepType === 'k8s_exec' || stepType === 'k8s_logs') && (
                            <Form.Item
                                name={['k8s_config', 'container_name']}
                                label="ÂÆπÂô®ÂêçÁß∞"
                            >
                                <Input placeholder="‰æãÂ¶Ç: my-app-container" />
                            </Form.Item>
                        )}

                        {stepType === 'k8s_exec' && (
                            <Form.Item
                                name={['k8s_config', 'command']}
                                label="ÊâßË°åÂëΩ‰ª§"
                                rules={[{ required: true, message: 'ËØ∑ËæìÂÖ•ÂëΩ‰ª§' }]}
                            >
                                <Input placeholder="‰æãÂ¶Ç: /bin/bash -c 'echo hello'" />
                            </Form.Item>
                        )}
                    </div>
                </div>
            );
        };

        const DockerK8sStepTest = () => {
            const [form] = Form.useForm();
            const [selectedStepType, setSelectedStepType] = useState('');
            const [testResults, setTestResults] = useState([]);
            const [formValues, setFormValues] = useState({});

            const handleStepTypeChange = (value) => {
                setSelectedStepType(value);
                form.resetFields();
            };

            const handleFormChange = () => {
                const values = form.getFieldsValue();
                setFormValues(values);
            };

            const runTest = async () => {
                try {
                    const values = await form.validateFields();
                    const result = {
                        timestamp: new Date().toLocaleTimeString(),
                        success: true,
                        stepType: selectedStepType,
                        config: values,
                        message: `‚úÖ ${selectedStepType} ÈÖçÁΩÆÈ™åËØÅÊàêÂäü`
                    };
                    setTestResults(prev => [result, ...prev.slice(0, 4)]);
                } catch (error) {
                    const result = {
                        timestamp: new Date().toLocaleTimeString(),
                        success: false,
                        stepType: selectedStepType,
                        error: error.errorFields,
                        message: `‚ùå ${selectedStepType} ÈÖçÁΩÆÈ™åËØÅÂ§±Ë¥•`
                    };
                    setTestResults(prev => [result, ...prev.slice(0, 4)]);
                }
            };

            const clearResults = () => {
                setTestResults([]);
            };

            return (
                <div className="container">
                    <Title level={2}>üöÄ Docker/K8s Ê≠•È™§Á±ªÂûãÊµãËØï</Title>
                    <Paragraph>
                        Ëøô‰∏™ÊµãËØïÈ°µÈù¢Áî®‰∫éÈ™åËØÅÊñ∞Â¢ûÁöÑ Docker Âíå Kubernetes Ê≠•È™§Á±ªÂûãÁöÑÂâçÁ´ØÈÖçÁΩÆÁïåÈù¢„ÄÇ
                        ÈÄâÊã©‰∏çÂêåÁöÑÊ≠•È™§Á±ªÂûãÊù•Êü•ÁúãÁõ∏Â∫îÁöÑÈÖçÁΩÆË°®Âçï„ÄÇ
                    </Paragraph>

                    <Card title="Ê≠•È™§Á±ªÂûãÈÄâÊã©" style={{ marginBottom: 24 }}>
                        <Row gutter={16}>
                            <Col span={12}>
                                <Title level={4}>üê≥ Docker Ê≠•È™§</Title>
                                <Space wrap>
                                    {dockerStepTypes.map(type => (
                                        <Button
                                            key={type.value}
                                            type={selectedStepType === type.value ? 'primary' : 'default'}
                                            onClick={() => handleStepTypeChange(type.value)}
                                            style={{ marginBottom: 8 }}
                                        >
                                            {type.label}
                                        </Button>
                                    ))}
                                </Space>
                            </Col>
                            <Col span={12}>
                                <Title level={4}>‚ò∏Ô∏è Kubernetes Ê≠•È™§</Title>
                                <Space wrap>
                                    {k8sStepTypes.map(type => (
                                        <Button
                                            key={type.value}
                                            type={selectedStepType === type.value ? 'primary' : 'default'}
                                            onClick={() => handleStepTypeChange(type.value)}
                                            style={{ marginBottom: 8 }}
                                        >
                                            {type.label}
                                        </Button>
                                    ))}
                                </Space>
                            </Col>
                        </Row>
                    </Card>

                    {selectedStepType && (
                        <Form 
                            form={form} 
                            layout="vertical"
                            onValuesChange={handleFormChange}
                        >
                            <Card title={`ÈÖçÁΩÆË°®Âçï - ${selectedStepType}`} style={{ marginBottom: 24 }}>
                                <Form.Item
                                    name="name"
                                    label="Ê≠•È™§ÂêçÁß∞"
                                    rules={[{ required: true, message: 'ËØ∑ËæìÂÖ•Ê≠•È™§ÂêçÁß∞' }]}
                                >
                                    <Input placeholder="ËæìÂÖ•Ê≠•È™§ÂêçÁß∞" />
                                </Form.Item>

                                <Form.Item
                                    name="description"
                                    label="Ê≠•È™§ÊèèËø∞"
                                >
                                    <Input placeholder="ËæìÂÖ•Ê≠•È™§ÊèèËø∞ÔºàÂèØÈÄâÔºâ" />
                                </Form.Item>

                                <DockerStepConfigTest stepType={selectedStepType} form={form} />
                                <KubernetesStepConfigTest stepType={selectedStepType} form={form} />

                                <Form.Item
                                    name="timeout_seconds"
                                    label="Ë∂ÖÊó∂Êó∂Èó¥ÔºàÁßíÔºâ"
                                    initialValue={300}
                                >
                                    <InputNumber min={1} max={3600} style={{ width: '100%' }} />
                                </Form.Item>

                                <Space>
                                    <Button type="primary" onClick={runTest}>
                                        È™åËØÅÈÖçÁΩÆ
                                    </Button>
                                    <Button onClick={() => form.resetFields()}>
                                        ÈáçÁΩÆË°®Âçï
                                    </Button>
                                </Space>
                            </Card>
                        </Form>
                    )}

                    {formValues && Object.keys(formValues).length > 0 && (
                        <Card title="ÂÆûÊó∂ÈÖçÁΩÆÈ¢ÑËßà" style={{ marginBottom: 24 }}>
                            <div className="code-block">
                                {JSON.stringify(formValues, null, 2)}
                            </div>
                        </Card>
                    )}

                    {testResults.length > 0 && (
                        <Card 
                            title="ÊµãËØïÁªìÊûú" 
                            style={{ marginBottom: 24 }}
                            extra={
                                <Button onClick={clearResults}>Ê∏ÖÈô§ÁªìÊûú</Button>
                            }
                        >
                            {testResults.map((result, index) => (
                                <div 
                                    key={index} 
                                    className={`test-result ${result.success ? 'success' : 'error'}`}
                                >
                                    <div style={{ fontWeight: 500, marginBottom: 8 }}>
                                        [{result.timestamp}] {result.message}
                                    </div>
                                    {result.success ? (
                                        <div className="code-block">
                                            {JSON.stringify(result.config, null, 2)}
                                        </div>
                                    ) : (
                                        <div style={{ color: '#ff4d4f' }}>
                                            È™åËØÅÈîôËØØ: {result.error?.map(err => err.errors.join(', ')).join('; ')}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </Card>
                    )}

                    <Alert
                        message="ÂäüËÉΩËØ¥Êòé"
                        description={
                            <div>
                                <p><strong>Docker Ê≠•È™§Á±ªÂûã:</strong></p>
                                <ul>
                                    <li><code>docker_build</code>: ÊûÑÂª∫ Docker ÈïúÂÉè</li>
                                    <li><code>docker_run</code>: ËøêË°å Docker ÂÆπÂô®</li>
                                    <li><code>docker_push</code>: Êé®ÈÄÅÈïúÂÉèÂà∞Ê≥®ÂÜåË°®</li>
                                    <li><code>docker_pull</code>: ‰ªéÊ≥®ÂÜåË°®ÊãâÂèñÈïúÂÉè</li>
                                </ul>
                                <p><strong>Kubernetes Ê≠•È™§Á±ªÂûã:</strong></p>
                                <ul>
                                    <li><code>k8s_deploy</code>: ÈÉ®ÁΩ≤Â∫îÁî®Âà∞ K8s ÈõÜÁæ§</li>
                                    <li><code>k8s_scale</code>: Êâ©Áº©ÂÆπ K8s ÈÉ®ÁΩ≤</li>
                                    <li><code>k8s_delete</code>: Âà†Èô§ K8s ËµÑÊ∫ê</li>
                                    <li><code>k8s_wait</code>: Á≠âÂæÖ K8s ËµÑÊ∫êÁä∂ÊÄÅ</li>
                                    <li><code>k8s_exec</code>: Âú® Pod ‰∏≠ÊâßË°åÂëΩ‰ª§</li>
                                    <li><code>k8s_logs</code>: Ëé∑Âèñ Pod Êó•Âøó</li>
                                </ul>
                            </div>
                        }
                        type="info"
                        showIcon
                    />
                </div>
            );
        };

        ReactDOM.render(<DockerK8sStepTest />, document.getElementById('root'));
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>
