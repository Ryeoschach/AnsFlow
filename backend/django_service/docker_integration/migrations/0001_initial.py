# Generated by Django 4.2.23 on 2025-07-09 02:37

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='DockerContainer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True, verbose_name='容器名称')),
                ('container_id', models.CharField(blank=True, max_length=64, verbose_name='容器ID')),
                ('command', models.TextField(blank=True, verbose_name='启动命令')),
                ('working_dir', models.CharField(blank=True, max_length=255, verbose_name='工作目录')),
                ('environment_vars', models.JSONField(default=dict, verbose_name='环境变量')),
                ('port_mappings', models.JSONField(default=list, verbose_name='端口映射')),
                ('volumes', models.JSONField(default=list, verbose_name='数据卷')),
                ('network_mode', models.CharField(default='bridge', max_length=50, verbose_name='网络模式')),
                ('memory_limit', models.CharField(blank=True, max_length=20, verbose_name='内存限制')),
                ('cpu_limit', models.CharField(blank=True, max_length=20, verbose_name='CPU限制')),
                ('status', models.CharField(choices=[('created', '已创建'), ('running', '运行中'), ('paused', '已暂停'), ('restarting', '重启中'), ('removing', '删除中'), ('stopped', '已停止'), ('exited', '已退出'), ('dead', '已死亡')], default='created', max_length=20, verbose_name='状态')),
                ('exit_code', models.IntegerField(blank=True, null=True, verbose_name='退出代码')),
                ('started_at', models.DateTimeField(blank=True, null=True, verbose_name='启动时间')),
                ('finished_at', models.DateTimeField(blank=True, null=True, verbose_name='结束时间')),
                ('description', models.TextField(blank=True, verbose_name='描述')),
                ('labels', models.JSONField(default=dict, verbose_name='标签')),
                ('auto_remove', models.BooleanField(default=False, verbose_name='自动删除')),
                ('restart_policy', models.CharField(default='no', max_length=20, verbose_name='重启策略')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL, verbose_name='创建者')),
            ],
            options={
                'verbose_name': 'Docker容器',
                'verbose_name_plural': 'Docker容器',
                'db_table': 'docker_container',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DockerRegistry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True, verbose_name='仓库名称')),
                ('url', models.URLField(verbose_name='仓库地址')),
                ('registry_type', models.CharField(choices=[('dockerhub', 'Docker Hub'), ('private', '私有仓库'), ('harbor', 'Harbor'), ('ecr', 'AWS ECR'), ('gcr', 'Google GCR'), ('acr', 'Azure ACR')], default='dockerhub', max_length=20, verbose_name='仓库类型')),
                ('username', models.CharField(blank=True, max_length=100, verbose_name='用户名')),
                ('description', models.TextField(blank=True, verbose_name='描述')),
                ('auth_config', models.JSONField(default=dict, verbose_name='认证配置')),
                ('status', models.CharField(choices=[('active', '活跃'), ('inactive', '非活跃'), ('error', '错误')], default='active', max_length=20, verbose_name='状态')),
                ('last_check', models.DateTimeField(blank=True, null=True, verbose_name='最后检查时间')),
                ('check_message', models.TextField(blank=True, verbose_name='检查信息')),
                ('is_default', models.BooleanField(default=False, verbose_name='默认仓库')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL, verbose_name='创建者')),
            ],
            options={
                'verbose_name': 'Docker仓库',
                'verbose_name_plural': 'Docker仓库',
                'db_table': 'docker_registry',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DockerImage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='镜像名称')),
                ('tag', models.CharField(default='latest', max_length=100, verbose_name='镜像标签')),
                ('dockerfile_content', models.TextField(verbose_name='Dockerfile内容')),
                ('build_context', models.CharField(default='.', max_length=500, verbose_name='构建上下文')),
                ('build_args', models.JSONField(default=dict, verbose_name='构建参数')),
                ('image_size', models.BigIntegerField(blank=True, null=True, verbose_name='镜像大小(字节)')),
                ('image_id', models.CharField(blank=True, max_length=64, verbose_name='镜像ID')),
                ('image_digest', models.CharField(blank=True, max_length=100, verbose_name='镜像摘要')),
                ('build_status', models.CharField(choices=[('pending', '待构建'), ('building', '构建中'), ('success', '构建成功'), ('failed', '构建失败'), ('cancelled', '已取消')], default='pending', max_length=20, verbose_name='构建状态')),
                ('build_logs', models.TextField(blank=True, verbose_name='构建日志')),
                ('build_started_at', models.DateTimeField(blank=True, null=True, verbose_name='构建开始时间')),
                ('build_completed_at', models.DateTimeField(blank=True, null=True, verbose_name='构建完成时间')),
                ('build_duration', models.IntegerField(blank=True, null=True, verbose_name='构建耗时(秒)')),
                ('is_pushed', models.BooleanField(default=False, verbose_name='是否已推送')),
                ('pushed_at', models.DateTimeField(blank=True, null=True, verbose_name='推送时间')),
                ('description', models.TextField(blank=True, verbose_name='描述')),
                ('labels', models.JSONField(default=dict, verbose_name='标签')),
                ('is_template', models.BooleanField(default=False, verbose_name='是否为模板')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL, verbose_name='创建者')),
                ('registry', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='docker_integration.dockerregistry', verbose_name='镜像仓库')),
            ],
            options={
                'verbose_name': 'Docker镜像',
                'verbose_name_plural': 'Docker镜像',
                'db_table': 'docker_image',
                'ordering': ['-created_at'],
                'unique_together': {('name', 'tag', 'registry')},
            },
        ),
        migrations.CreateModel(
            name='DockerContainerStats',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('cpu_usage_percent', models.FloatField(verbose_name='CPU使用率(%)')),
                ('cpu_system_usage', models.BigIntegerField(verbose_name='系统CPU使用')),
                ('cpu_total_usage', models.BigIntegerField(verbose_name='总CPU使用')),
                ('memory_usage', models.BigIntegerField(verbose_name='内存使用(字节)')),
                ('memory_limit', models.BigIntegerField(verbose_name='内存限制(字节)')),
                ('memory_percent', models.FloatField(verbose_name='内存使用率(%)')),
                ('network_rx_bytes', models.BigIntegerField(default=0, verbose_name='网络接收字节')),
                ('network_tx_bytes', models.BigIntegerField(default=0, verbose_name='网络发送字节')),
                ('block_read_bytes', models.BigIntegerField(default=0, verbose_name='磁盘读取字节')),
                ('block_write_bytes', models.BigIntegerField(default=0, verbose_name='磁盘写入字节')),
                ('pids', models.IntegerField(default=0, verbose_name='进程数')),
                ('recorded_at', models.DateTimeField(auto_now_add=True, verbose_name='记录时间')),
                ('container', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='stats', to='docker_integration.dockercontainer', verbose_name='容器')),
            ],
            options={
                'verbose_name': 'Docker容器统计',
                'verbose_name_plural': 'Docker容器统计',
                'db_table': 'docker_container_stats',
                'ordering': ['-recorded_at'],
            },
        ),
        migrations.AddField(
            model_name='dockercontainer',
            name='image',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='docker_integration.dockerimage', verbose_name='镜像'),
        ),
        migrations.CreateModel(
            name='DockerCompose',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True, verbose_name='项目名称')),
                ('compose_content', models.TextField(verbose_name='docker-compose.yml内容')),
                ('working_directory', models.CharField(max_length=500, verbose_name='工作目录')),
                ('environment_file', models.TextField(blank=True, verbose_name='.env文件内容')),
                ('status', models.CharField(choices=[('created', '已创建'), ('running', '运行中'), ('stopped', '已停止'), ('paused', '已暂停'), ('error', '错误')], default='created', max_length=20, verbose_name='状态')),
                ('services', models.JSONField(default=list, verbose_name='服务列表')),
                ('networks', models.JSONField(default=list, verbose_name='网络列表')),
                ('volumes', models.JSONField(default=list, verbose_name='数据卷列表')),
                ('description', models.TextField(blank=True, verbose_name='描述')),
                ('labels', models.JSONField(default=dict, verbose_name='标签')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL, verbose_name='创建者')),
            ],
            options={
                'verbose_name': 'Docker Compose',
                'verbose_name_plural': 'Docker Compose项目',
                'db_table': 'docker_compose',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DockerImageVersion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('version', models.CharField(max_length=50, verbose_name='版本号')),
                ('dockerfile_content', models.TextField(verbose_name='Dockerfile内容快照')),
                ('build_context', models.CharField(max_length=500, verbose_name='构建上下文')),
                ('build_args', models.JSONField(default=dict, verbose_name='构建参数')),
                ('checksum', models.CharField(max_length=64, verbose_name='内容校验和')),
                ('changelog', models.TextField(blank=True, verbose_name='变更说明')),
                ('docker_image_id', models.CharField(blank=True, max_length=64, verbose_name='镜像ID')),
                ('image_size', models.BigIntegerField(blank=True, null=True, verbose_name='镜像大小')),
                ('is_release', models.BooleanField(default=False, verbose_name='是否为发布版本')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL, verbose_name='创建者')),
                ('image', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='versions', to='docker_integration.dockerimage', verbose_name='镜像')),
            ],
            options={
                'verbose_name': 'Docker镜像版本',
                'verbose_name_plural': 'Docker镜像版本历史',
                'db_table': 'docker_image_version',
                'ordering': ['-created_at'],
                'unique_together': {('image', 'version')},
            },
        ),
    ]
